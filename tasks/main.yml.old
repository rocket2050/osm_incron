---
- name: Install incron in Ubuntu 16 && Ubuntu 14
  apt:
    pkg: incron
    state: present 
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: Install incron in Centos all versions
  yum: name={{ item }} state=present
  with_items:
    - epel-release
    - incron
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

#- name: To set incron user
#  template:
#    src: incron.allow.j2
#    dest: /etc/incron.allow
#  tags:
#    - blue

- lineinfile:
    dest: /etc/incron.allow
    line: "{{ incron_user }}"

- name: Ensure Incron is running and enabled as configured.
  service:
    name: "{{ incron_daemon }}"
    state: started
    enabled: yes
  when: ansible_distribution == 'Debian'




#  when: incron_enabled

- name: Ensure Incron is stopped and disabled as configured.
  service:
    name: "{{ incron_daemon }}"
    state: stopped
    enabled: no
  when: not incron_enabled

- name: Setup incron.d scripts
  template:
    src: incrontab.j2
    dest: "{{ incron_system_tables_dir }}{{ item.name }}"
  with_items: "{{ incron_system_tables }}"
  when: incron_system_tables is defined
  notify:
   - restart incron
  
